<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Syntax Prime V2 - AI Assistant</title>
    <link rel="icon" type="image/png" href="static/favicon.png">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Auth Check -->
    <script>
        if (!sessionStorage.getItem('syntaxprime_auth')) {
            window.location.href = 'login.html';
        }
    </script>

    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <div class="header-left">
                <button class="sidebar-toggle" id="sidebarToggle">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                        <line x1="9" y1="3" x2="9" y2="21"/>
                    </svg>
                </button>
                <div class="logo-header">
                    <div class="logo-icon">
                        <img src="static/syntax-buffering.png" alt="Syntax Prime" style="width: 32px; height: 32px; object-fit: contain;">
                    </div>
                    <div class="logo-text">
                        <span class="logo-name">Syntax Prime</span>
                        <span class="logo-version">v2.0</span>
                    </div>
                </div>
            </div>
            
            <div class="header-center">
                <div class="personality-selector">
                    <select id="personalitySelect">
                        <option value="syntaxprime">SyntaxPrime</option>
                        <option value="syntaxbot">SyntaxBot</option>
                        <option value="nilexe">Nil.exe</option>
                        <option value="ggpt">GGPT</option>
                    </select>
                </div>
            </div>
            
            <div class="header-right">
                <button class="header-button" id="newChatBtn" title="New Conversation">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                        <polyline points="9,22 9,12 15,12 15,22"/>
                    </svg>
                </button>
                <button class="header-button" id="settingsBtn" title="Settings">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3"/>
                        <path d="m12 1 0 6m0 6 0 6m11-5-6 0m-6 0-6 0"/>
                    </svg>
                </button>
                <button class="header-button" id="logoutBtn" title="Logout">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                        <polyline points="16,17 21,12 16,7"/>
                        <line x1="21" y1="12" x2="9" y2="12"/>
                    </svg>
                </button>
            </div>
        </header>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Sidebar -->
            <aside class="sidebar" id="sidebar">
                <!-- Proactive Insights Section -->
                <div class="sidebar-section proactive-section">
                    <div class="proactive-header">
                        <h3>‚ö° Insights</h3>
                        <span class="proactive-count" id="proactiveCount">0</span>
                    </div>
                    <div class="proactive-list" id="proactiveList">
                        <div class="no-proactive">
                            <p>No pending insights</p>
                            <small>I'll notify you when something needs attention</small>
                        </div>
                    </div>
                </div>

                <!-- Projects Section -->
                <div class="sidebar-section projects-section">
                    <div class="projects-header">
                        <h3>üìÅ Projects</h3>
                        <div class="projects-header-actions">
                            <span class="project-count" id="projectCount">0</span>
                            <button class="add-project-btn" id="addProjectBtn" title="New Project">+</button>
                        </div>
                    </div>
                    <div class="projects-list" id="projectsList">
                        <div class="loading-projects">Loading projects...</div>
                    </div>
                </div>

                <div class="sidebar-section">
                    <div class="sidebar-header">
                        <h3>Bookmarks</h3>
                        <span class="bookmark-count" id="bookmarkCount">0</span>
                    </div>
                    <div class="bookmarks-list" id="bookmarksList">
                        <div class="no-bookmarks">
                            <p>No bookmarks yet</p>
                            <small>Use "Remember This" to create your first bookmark</small>
                        </div>
                    </div>
                </div>
                
                <div class="sidebar-section">
                    <div class="sidebar-header">
                        <h3>Recent Conversations</h3>
                    </div>
                    <div class="conversations-list" id="conversationsList">
                        <div class="loading-conversations">Loading conversations...</div>
                    </div>
                </div>
            </aside>

            <!-- Chat Area -->
            <main class="chat-container">
                <div class="chat-messages" id="chatMessages">
                    <!-- Simplified Welcome Message -->
                    <div class="welcome-message">
                        <div class="welcome-icon">
                            <img src="static/syntax-buffering.png" alt="Syntax Prime" style="width: 64px; height: 64px; object-fit: contain;">
                        </div>
                        <h2 id="greetingText">Hey there</h2>
                        <p id="greetingSubtext">What can I help you with?</p>
                        <div class="welcome-project-indicator" id="welcomeProjectIndicator" style="display: none;">
                            <span class="project-icon" id="welcomeProjectIcon">üìÅ</span>
                            <span id="welcomeProjectName">Project Name</span>
                        </div>
                    </div>
                </div>

                <!-- Chat Input -->
                <div class="chat-input-container">
                    <div class="file-upload-area" id="fileUploadArea" style="display: none;">
                        <div class="uploaded-files" id="uploadedFiles"></div>
                    </div>
                    
                    <div class="chat-input-wrapper">
                        <input type="file" id="fileInput" multiple accept="image/*,.pdf,.txt,.md,.csv,.doc,.docx,.xls,.xlsx,.py" style="display: none;">
                        
                        <button class="input-button file-button" id="fileButton" title="Upload Files">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66L9.64 16.2a2 2 0 0 1-2.83-2.83l8.49-8.48"/>
                            </svg>
                        </button>
                        
                        <div class="input-field-container">
                            <textarea
                                id="messageInput"
                                placeholder="Message Syntax Prime..."
                                rows="1"
                                maxlength="8000"
                            ></textarea>
                            <div class="input-footer">
                                <span class="char-count" id="charCount">0/8000</span>
                                <div class="input-actions">
                                    <button class="input-action" id="rememberBtn" title="Remember This" style="display: none;">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.29 1.51 4.04 3 5.5Z"/>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <button class="send-button" id="sendButton" disabled title="Send message (Enter)" type="button">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M22 2 11 13"/>
                                <path d="m22 2-7 20-4-9-9-4z"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Modals -->
    <div class="modal" id="bookmarkModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Remember This</h3>
                <button class="modal-close" id="closeBookmarkModal">&times;</button>
            </div>
            <div class="modal-body">
                <p>What should we name this bookmark?</p>
                <input type="text" id="bookmarkName" placeholder="Enter bookmark name..." maxlength="100">
                <div class="bookmark-preview" id="bookmarkPreview"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelBookmark">Cancel</button>
                <button class="btn btn-primary" id="saveBookmark">Save Bookmark</button>
            </div>
        </div>
    </div>

    <!-- Drive Modal -->
    <div class="modal" id="driveModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üíæ Copy to Google Drive</h3>
                <button class="modal-close" id="closeDriveModal">&times;</button>
            </div>
            <div class="modal-body">
                <p>What should we name this document?</p>
                <input type="text" id="driveDocName" placeholder="Enter document name..." maxlength="100">
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelDrive">Cancel</button>
                <button class="btn btn-primary" id="saveDrive">Create Document</button>
            </div>
        </div>
    </div>
    
    <div class="modal" id="settingsModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Settings</h3>
                <button class="modal-close" id="closeSettingsModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="setting-group">
                    <label>Default Personality</label>
                    <select id="defaultPersonality">
                        <option value="syntaxprime">SyntaxPrime</option>
                        <option value="syntaxbot">SyntaxBot</option>
                        <option value="nilexe">Nil.exe</option>
                        <option value="ggpt">GGPT</option>
                    </select>
                </div>
                <div class="setting-group">
                    <label>Auto-save Conversations</label>
                    <input type="checkbox" id="autoSave" checked>
                </div>
                <div class="setting-group">
                    <label>Show Typing Indicators</label>
                    <input type="checkbox" id="showTyping" checked>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="saveSettings">Save Settings</button>
            </div>
        </div>
    </div>

    <!-- New Project Modal -->
    <div class="modal" id="newProjectModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üìÅ New Project</h3>
                <button class="modal-close" id="closeNewProjectModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Project Name <small>(identifier, no spaces)</small></label>
                    <input type="text" id="newProjectName" placeholder="my-project" maxlength="50" pattern="[a-zA-Z0-9_-]+">
                </div>
                <div class="form-group">
                    <label>Display Name</label>
                    <input type="text" id="newProjectDisplayName" placeholder="My Awesome Project" maxlength="100">
                </div>
                <div class="form-group">
                    <label>Description <small>(optional)</small></label>
                    <textarea id="newProjectDescription" placeholder="What is this project about?" maxlength="500" rows="2"></textarea>
                </div>
                <div class="form-group">
                    <label>Instructions <small>(AI context for this project)</small></label>
                    <textarea id="newProjectInstructions" placeholder="When working on this project, remember to..." maxlength="2000" rows="4"></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Color</label>
                        <div class="color-picker" id="newProjectColorPicker">
                            <div class="color-swatch selected" data-color="#EF4444" style="background: #EF4444;"></div>
                            <div class="color-swatch" data-color="#F97316" style="background: #F97316;"></div>
                            <div class="color-swatch" data-color="#F59E0B" style="background: #F59E0B;"></div>
                            <div class="color-swatch" data-color="#84CC16" style="background: #84CC16;"></div>
                            <div class="color-swatch" data-color="#10B981" style="background: #10B981;"></div>
                            <div class="color-swatch" data-color="#06B6D4" style="background: #06B6D4;"></div>
                            <div class="color-swatch" data-color="#3B82F6" style="background: #3B82F6;"></div>
                            <div class="color-swatch" data-color="#8B5CF6" style="background: #8B5CF6;"></div>
                            <div class="color-swatch" data-color="#EC4899" style="background: #EC4899;"></div>
                            <div class="color-swatch" data-color="#6B7280" style="background: #6B7280;"></div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Icon</label>
                        <div class="icon-picker" id="newProjectIconPicker">
                            <button class="icon-option selected" data-icon="üìÅ">üìÅ</button>
                            <button class="icon-option" data-icon="üíº">üíº</button>
                            <button class="icon-option" data-icon="üöÄ">üöÄ</button>
                            <button class="icon-option" data-icon="üí°">üí°</button>
                            <button class="icon-option" data-icon="üéØ">üéØ</button>
                            <button class="icon-option" data-icon="üìä">üìä</button>
                            <button class="icon-option" data-icon="üîß">üîß</button>
                            <button class="icon-option" data-icon="üìù">üìù</button>
                            <button class="icon-option" data-icon="üé®">üé®</button>
                            <button class="icon-option" data-icon="üè†">üè†</button>
                            <button class="icon-option" data-icon="‚ù§Ô∏è">‚ù§Ô∏è</button>
                            <button class="icon-option" data-icon="‚≠ê">‚≠ê</button>
                            <button class="icon-option" data-icon="üî•">üî•</button>
                            <button class="icon-option" data-icon="üíª">üíª</button>
                            <button class="icon-option" data-icon="üì±">üì±</button>
                            <button class="icon-option" data-icon="üåê">üåê</button>
                            <button class="icon-option" data-icon="üìà">üìà</button>
                            <button class="icon-option" data-icon="üé¨">üé¨</button>
                            <button class="icon-option" data-icon="üéµ">üéµ</button>
                            <button class="icon-option" data-icon="üìö">üìö</button>
                        </div>
                    </div>
                </div>
                <div class="project-preview" id="newProjectPreview">
                    <div class="project-preview-color" id="newProjectPreviewColor" style="background: #EF4444;"></div>
                    <div class="project-preview-icon" id="newProjectPreviewIcon">üìÅ</div>
                    <div class="project-preview-info">
                        <div class="project-preview-name" id="newProjectPreviewName">Project Name</div>
                        <div class="project-preview-display-name" id="newProjectPreviewDisplayName">Display Name</div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelNewProject">Cancel</button>
                <button class="btn btn-primary" id="saveNewProject">Create Project</button>
            </div>
        </div>
    </div>

    <!-- Edit Project Modal -->
    <div class="modal" id="editProjectModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>‚úèÔ∏è Edit Project</h3>
                <button class="modal-close" id="closeEditProjectModal">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="editProjectId">
                <div class="form-group">
                    <label>Project Name <small>(identifier, no spaces)</small></label>
                    <input type="text" id="editProjectName" placeholder="my-project" maxlength="50" pattern="[a-zA-Z0-9_-]+">
                </div>
                <div class="form-group">
                    <label>Display Name</label>
                    <input type="text" id="editProjectDisplayName" placeholder="My Awesome Project" maxlength="100">
                </div>
                <div class="form-group">
                    <label>Description <small>(optional)</small></label>
                    <textarea id="editProjectDescription" placeholder="What is this project about?" maxlength="500" rows="2"></textarea>
                </div>
                <div class="form-group">
                    <label>Instructions <small>(AI context for this project)</small></label>
                    <textarea id="editProjectInstructions" placeholder="When working on this project, remember to..." maxlength="2000" rows="4"></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Color</label>
                        <div class="color-picker" id="editProjectColorPicker">
                            <div class="color-swatch" data-color="#EF4444" style="background: #EF4444;"></div>
                            <div class="color-swatch" data-color="#F97316" style="background: #F97316;"></div>
                            <div class="color-swatch" data-color="#F59E0B" style="background: #F59E0B;"></div>
                            <div class="color-swatch" data-color="#84CC16" style="background: #84CC16;"></div>
                            <div class="color-swatch" data-color="#10B981" style="background: #10B981;"></div>
                            <div class="color-swatch" data-color="#06B6D4" style="background: #06B6D4;"></div>
                            <div class="color-swatch" data-color="#3B82F6" style="background: #3B82F6;"></div>
                            <div class="color-swatch" data-color="#8B5CF6" style="background: #8B5CF6;"></div>
                            <div class="color-swatch" data-color="#EC4899" style="background: #EC4899;"></div>
                            <div class="color-swatch" data-color="#6B7280" style="background: #6B7280;"></div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Icon</label>
                        <div class="icon-picker" id="editProjectIconPicker">
                            <button class="icon-option" data-icon="üìÅ">üìÅ</button>
                            <button class="icon-option" data-icon="üíº">üíº</button>
                            <button class="icon-option" data-icon="üöÄ">üöÄ</button>
                            <button class="icon-option" data-icon="üí°">üí°</button>
                            <button class="icon-option" data-icon="üéØ">üéØ</button>
                            <button class="icon-option" data-icon="üìä">üìä</button>
                            <button class="icon-option" data-icon="üîß">üîß</button>
                            <button class="icon-option" data-icon="üìù">üìù</button>
                            <button class="icon-option" data-icon="üé®">üé®</button>
                            <button class="icon-option" data-icon="üè†">üè†</button>
                            <button class="icon-option" data-icon="‚ù§Ô∏è">‚ù§Ô∏è</button>
                            <button class="icon-option" data-icon="‚≠ê">‚≠ê</button>
                            <button class="icon-option" data-icon="üî•">üî•</button>
                            <button class="icon-option" data-icon="üíª">üíª</button>
                            <button class="icon-option" data-icon="üì±">üì±</button>
                            <button class="icon-option" data-icon="üåê">üåê</button>
                            <button class="icon-option" data-icon="üìà">üìà</button>
                            <button class="icon-option" data-icon="üé¨">üé¨</button>
                            <button class="icon-option" data-icon="üéµ">üéµ</button>
                            <button class="icon-option" data-icon="üìö">üìö</button>
                        </div>
                    </div>
                </div>
                <div class="project-preview" id="editProjectPreview">
                    <div class="project-preview-color" id="editProjectPreviewColor" style="background: #EF4444;"></div>
                    <div class="project-preview-icon" id="editProjectPreviewIcon">üìÅ</div>
                    <div class="project-preview-info">
                        <div class="project-preview-name" id="editProjectPreviewName">Project Name</div>
                        <div class="project-preview-display-name" id="editProjectPreviewDisplayName">Display Name</div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-danger" id="deleteProject">Delete Project</button>
                <button class="btn btn-secondary" id="cancelEditProject">Cancel</button>
                <button class="btn btn-primary" id="saveEditProject">Save Changes</button>
            </div>
        </div>
    </div>

    <!-- Move to Project Modal -->
    <div class="modal" id="moveToProjectModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üìÇ Move to Project</h3>
                <button class="modal-close" id="closeMoveToProjectModal">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="moveThreadId">
                <p>Select a project for this conversation:</p>
                <div class="move-project-list" id="moveProjectList">
                    <!-- Populated by JavaScript -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelMoveToProject">Cancel</button>
                <button class="btn btn-primary" id="confirmMoveToProject" disabled>Move</button>
            </div>
        </div>
    </div>

    <!-- Context Menu (for conversation right-click) -->
    <div class="context-menu" id="conversationContextMenu">
        <div class="context-menu-item" id="contextMenuOpen">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/>
                <polyline points="15,3 21,3 21,9"/>
                <line x1="10" y1="14" x2="21" y2="3"/>
            </svg>
            Open
        </div>
        <div class="context-menu-item" id="contextMenuMoveToProject">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/>
            </svg>
            Move to Project
        </div>
        <div class="context-menu-divider"></div>
        <div class="context-menu-item danger" id="contextMenuDelete">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="3,6 5,6 21,6"/>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
            </svg>
            Delete
        </div>
    </div>

    <!-- Drag & Drop Overlay -->
    <div class="drag-overlay" id="dragOverlay" style="display: none;">
        <div class="drag-content">
            <div class="drag-icon">üìÅ</div>
            <h3>Drop files to upload</h3>
            <p>Images, PDFs, text files, and CSV files are supported</p>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
